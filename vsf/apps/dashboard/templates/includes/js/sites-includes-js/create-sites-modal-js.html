<!--
  ========================================
  THIS SCRIPT IS INTENDED TO BE COUPLED WITH THE CREATE-SITES-MODAL.HTML

  INCLUDE THIS HTML IN THE CUSTOM SCRIPT BLOCK IN THE TEMPLATE THAT INCLUDES
  CREATE-SITES-MODAL.HTML
  ========================================
-->

<script>

  /*
  ========================================
  VERIFYING THAT THE INPUTS WAS FILLED
  ========================================
  */

  if ($("#vsf-sites-input").val() === "") {

    $("#create-sites-btn").prop("disabled", true);
  }

  if ($("#vsf-description-input").val() === "") {

    $("#create-sites-btn").prop("disabled", true);
  }

  $("#vsf-sites-input").keyup(function () {

    $("#create-sites-btn").prop("disabled", this.value.trim() === "" ? true : false);
  });

  /*
  ========================================
  THIS PART IS THE AJAX REQUEST
  ========================================
  */

  $("#create-sites-btn").click(function ( event ) {

    "use strict";
    event.preventDefault();

    let $form = $("#site-creation-form");
    let data  = $form.serialize();
    let url   = '{% url "sites:create_site" %}';

    $.ajax({
      type   : "POST",
      url    : url,
      data   : data,
      success: function ( data, status ) {

        $("#associateUrl").modal("hide");

        if ( data.error === null ) {
          Swal.fire({
            icon              : "success",
            title             : "The site has been created!",
            confirmButtonColor: "#28a745",
            confirmButtonText : "Continue"
          }).then((result) => {

            if ( result.isConfirmed ) {

              location.reload();
            }
          });
        }
        else {
          Swal.fire({
            icon              : "success",
            title             : "The name's site is already in use!",
            confirmButtonColor: "#dc3545",
            confirmButtonText : "Continue"
          })
        }
      },
      error: function ( XMLHttpRequest, textStatus, errorThrown ) {

        Swal.fire({
          icon              : "error",
          title             : "There was an error!",
          text              : `${ textStatus }: ${ errorThrown }`,
          confirmButtonColor: "#dc3545",
          confirmButtonText : "Continue"
        });
      }
    });
  });
</script>
